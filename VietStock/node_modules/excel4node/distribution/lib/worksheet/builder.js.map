{"version":3,"sources":["../../../source/lib/worksheet/builder.js"],"names":["xml","require","utils","types","hyperlinks","Picture","_addSheetPr","promiseObj","Promise","resolve","reject","o","ws","opts","printOptions","fitToHeight","fitToWidth","outline","summaryBelow","autoFilter","ref","summaryRight","ele","att","outlineEle","up","pageSetup","_addDimension","firstCell","lastCell","getExcelAlpha","lastUsedCol","lastUsedRow","_addSheetViews","sheetView","tabSelected","sv","showGridLines","workbookViewId","rightToLeft","zoomScale","zoomScaleNormal","zoomScalePageLayoutView","modifiedPaneParams","Object","keys","pane","forEach","k","push","length","pEle","xSplit","ySplit","topLeftCell","activePane","state","_addSheetFormatPr","sheetFormat","baseColWidth","defaultColWidth","defaultRowHeight","thickBottom","boolToInt","thickTop","_addCols","columnCount","colsEle","colId","cols","col","colEle","min","max","width","style","hidden","customWidth","outlineLevel","collapsed","_addSheetData","rows","processRows","theseRows","r","thisRow","cellRefs","sort","sortCellRefs","rEle","disableRowSpansOptimization","spans","s","customFormat","ht","customHeight","thickBot","i","cells","addToXMLele","processNextRows","splice","_addSheetProtection","sheetProtection","includeSheetProtection","sheet","objects","scenarios","getHashOfPassword","_addAutoFilter","startRow","filterRow","startCol","endCol","endRow","firstEmptyRow","undefined","curRow","firstColumn","lastColumn","startCell","endCell","wb","definedNameCollection","addDefinedName","localSheetId","name","refFormula","_addMergeCells","mergedCells","Array","cr","_addConditionalFormatting","cfRulesCollection","_addHyperlinks","hyperlinkCollection","_addDataValidations","dataValidationCollection","_addPrintOptions","addPrintOptions","poEle","centerHorizontal","centerVertical","printHeadings","printGridLines","_addPageMargins","margins","left","right","top","bottom","header","footer","_addPageSetup","addPageSetup","psEle","paperSize","paperHeight","paperWidth","scale","firstPageNumber","pageOrder","orientation","usePrinterDefaults","blackAndWhite","draft","cellComments","useFirstPageNumber","errors","horizontalDpi","verticalDpi","copies","_addPageBreaks","rowBreaks","pageBreaks","row","rbEle","bEle","pos","colBreaks","column","cbEle","_addHeaderFooter","addHeaderFooter","headerFooter","hfEle","alignWithMargins","differentFirst","differentOddEven","scaleWithDoc","oddHeader","text","oddFooter","evenHeader","evenFooter","firstHeader","firstFooter","_addDrawing","drawingCollection","isEmpty","dId","relationships","indexOf","sheetXML","xmlProlog","xmlString","wsXML","begin","chunk","then","end","catch","e","Error","stack","relsXML","sheetRelRequired","relXML","create","rId","Hyperlink","location","sheetId","doc","module","exports"],"mappings":"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","file":"builder.js","sourcesContent":["const xml = require('xmlbuilder');\nconst utils = require('../utils.js');\nconst types = require('../types/index.js');\nconst hyperlinks = require('./classes/hyperlink');\nconst Picture = require('../drawing/picture.js');\n\nlet _addSheetPr = (promiseObj) => {\n    // §18.3.1.82 sheetPr (Sheet Properties)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts;\n\n        // Check if any option that would require the sheetPr element to be added exists\n        if (\n            o.printOptions.fitToHeight !== null ||\n            o.printOptions.fitToWidth !== null ||\n            o.outline.summaryBelow !== null ||\n            o.autoFilter.ref !== null ||\n            o.outline.summaryRight\n\n        ) {\n            let ele = promiseObj.xml.ele('sheetPr');\n\n            if (o.autoFilter.ref) {\n                ele.att('enableFormatConditionsCalculation', 1);\n                ele.att('filterMode', 1);\n            }\n\n            if (o.outline.summaryBelow !== null || o.outline.summaryRight !== null) {\n                let outlineEle = ele.ele('outlinePr');\n                outlineEle.att('applyStyles', 1);\n                outlineEle.att('summaryBelow',  o.outline.summaryBelow === true ? 1 : 0);\n                outlineEle.att('summaryRight',  o.outline.summaryRight === true ? 1 : 0);\n                outlineEle.up();\n            }\n\n            // §18.3.1.65 pageSetUpPr (Page Setup Properties)\n            if (o.pageSetup.fitToHeight !== null || o.pageSetup.fitToWidth !== null) {\n                ele.ele('pageSetUpPr').att('fitToPage', 1).up();\n            }\n            ele.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addDimension = (promiseObj) => {\n    // §18.3.1.35 dimension (Worksheet Dimensions)\n    return new Promise((resolve, reject) => {\n        let firstCell = 'A1';\n        let lastCell = `${utils.getExcelAlpha(promiseObj.ws.lastUsedCol)}${promiseObj.ws.lastUsedRow}`;\n        let ele = promiseObj.xml.ele('dimension');\n        ele.att('ref', `${firstCell}:${lastCell}`);\n        ele.up();\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetViews = (promiseObj) => {\n    // §18.3.1.88 sheetViews (Sheet Views)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetView;\n        let ele = promiseObj.xml.ele('sheetViews');\n        let tabSelected = promiseObj.ws.opts;\n        let sv = ele.ele('sheetView')\n        .att('showGridLines', o.showGridLines)\n        .att('tabSelected', o.tabSelected)\n        .att('workbookViewId', o.workbookViewId)\n        .att('rightToLeft', o.rightToLeft)\n        .att('zoomScale', o.zoomScale)\n        .att('zoomScaleNormal', o.zoomScaleNormal)\n        .att('zoomScalePageLayoutView', o.zoomScalePageLayoutView);\n\n        let modifiedPaneParams = [];\n        Object.keys(o.pane).forEach((k) => {\n            if (o.pane[k] !== null) {\n                modifiedPaneParams.push(k);\n            }\n        });\n        if (modifiedPaneParams.length > 0) {\n            let pEle = sv.ele('pane');\n            o.pane.xSplit !== null ? pEle.att('xSplit', o.pane.xSplit) : null;\n            o.pane.ySplit !== null ? pEle.att('ySplit', o.pane.ySplit) : null;\n            o.pane.topLeftCell !== null ? pEle.att('topLeftCell', o.pane.topLeftCell) : null;\n            o.pane.activePane !== null ? pEle.att('activePane', o.pane.activePane) : null;\n            o.pane.state !== null ? pEle.att('state', o.pane.state) : null;\n            pEle.up();\n        }\n        sv.up();\n        ele.up();\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetFormatPr = (promiseObj) => {\n    // §18.3.1.81 sheetFormatPr (Sheet Format Properties)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetFormat;\n        let ele = promiseObj.xml.ele('sheetFormatPr');\n\n        o.baseColWidth !== null ? ele.att('baseColWidth', o.baseColWidth) : null;\n        o.defaultColWidth !== null ? ele.att('defaultColWidth', o.defaultColWidth) : null;\n        o.defaultRowHeight !== null ? ele.att('defaultRowHeight', o.defaultRowHeight) : ele.att('defaultRowHeight', 16);\n        o.thickBottom !== null ? ele.att('thickBottom', utils.boolToInt(o.thickBottom)) : null;\n        o.thickTop !== null ? ele.att('thickTop', utils.boolToInt(o.thickTop)) : null;\n\n\n        if (typeof o.defaultRowHeight === 'number') {\n            ele.att('customHeight', '1');\n        }\n        ele.up();\n        resolve(promiseObj);\n    });\n};\n\nlet _addCols = (promiseObj) => {\n    // §18.3.1.17 cols (Column Information)\n    return new Promise((resolve, reject) => {\n\n        if (promiseObj.ws.columnCount > 0) {\n            let colsEle = promiseObj.xml.ele('cols');\n\n            for (let colId in promiseObj.ws.cols) {\n                let col = promiseObj.ws.cols[colId];\n                let colEle = colsEle.ele('col');\n\n                col.min !== null ? colEle.att('min', col.min) : null;\n                col.max !== null ? colEle.att('max', col.max) : null;\n                col.width !== null ? colEle.att('width', col.width) : null;\n                col.style !== null ? colEle.att('style', col.style) : null;\n                col.hidden !== null ? colEle.att('hidden', utils.boolToInt(col.hidden)) : null;\n                col.customWidth !== null ? colEle.att('customWidth', utils.boolToInt(col.customWidth)) : null;\n                col.outlineLevel !== null ? colEle.att('outlineLevel', col.outlineLevel) : null;\n                col.collapsed !== null ? colEle.att('collapsed', utils.boolToInt(col.collapsed)) : null;\n                colEle.up();\n            }\n            colsEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addSheetData = (promiseObj) => {\n    // §18.3.1.80 sheetData (Sheet Data)\n    return new Promise((resolve, reject) => {\n\n        let ele = promiseObj.xml.ele('sheetData');\n        let rows = Object.keys(promiseObj.ws.rows);\n\n        let processRows = (theseRows) => {\n            for (var r = 0; r < theseRows.length; r++) {\n                let thisRow = promiseObj.ws.rows[theseRows[r]];\n                thisRow.cellRefs.sort(utils.sortCellRefs);\n\n                let rEle = ele.ele('row');\n\n                rEle.att('r', thisRow.r);\n                if (promiseObj.ws.opts.disableRowSpansOptimization !== true && thisRow.spans) {\n                    rEle.att('spans', thisRow.spans);\n                }\n                thisRow.s !== null ? rEle.att('s', thisRow.s) : null;\n                thisRow.customFormat !== null ? rEle.att('customFormat', thisRow.customFormat) : null;\n                thisRow.ht !== null ? rEle.att('ht', thisRow.ht) : null;\n                thisRow.hidden !== null ? rEle.att('hidden', thisRow.hidden) : null;\n                thisRow.customHeight === true || typeof promiseObj.ws.opts.sheetFormat.defaultRowHeight === 'number' ? rEle.att('customHeight', 1) : null;\n                thisRow.outlineLevel !== null ? rEle.att('outlineLevel', thisRow.outlineLevel) : null;\n                thisRow.collapsed !== null ? rEle.att('collapsed', thisRow.collapsed) : null;\n                thisRow.thickTop !== null ? rEle.att('thickTop', thisRow.thickTop) : null;\n                thisRow.thickBot !== null ? rEle.att('thickBot', thisRow.thickBot) : null;\n\n                for (var i = 0; i < thisRow.cellRefs.length; i++) {\n                    promiseObj.ws.cells[thisRow.cellRefs[i]].addToXMLele(rEle);\n                }\n\n                rEle.up();\n            }\n\n            processNextRows();\n        };\n\n        let processNextRows = () => {\n            let theseRows = rows.splice(0, 500);\n            if (theseRows.length === 0) {\n                ele.up();\n                return resolve(promiseObj);\n            }\n            processRows(theseRows);\n        };\n\n        processNextRows();\n\n    });\n};\n\nlet _addSheetProtection = (promiseObj) => {\n    // §18.3.1.85 sheetProtection (Sheet Protection Options)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.sheetProtection;\n        let includeSheetProtection = false;\n        Object.keys(o).forEach((k) =>  {\n            if (o[k] !== null) {\n                includeSheetProtection = true;\n            }\n        });\n\n        if (includeSheetProtection) {\n            // Set required fields with defaults if not specified\n            o.sheet = o.sheet !== null ? o.sheet : true;\n            o.objects = o.objects !== null ? o.objects : true;\n            o.scenarios = o.scenarios !== null ? o.scenarios : true;\n\n            let ele = promiseObj.xml.ele('sheetProtection');\n            Object.keys(o).forEach((k) => {\n                if (o[k] !== null) {\n                    if (k === 'password') {\n                        ele.att('password', utils.getHashOfPassword(o[k]));\n                    } else {\n                        ele.att(k, utils.boolToInt(o[k]));\n                    }\n                }\n            });\n            ele.up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addAutoFilter = (promiseObj) => {\n    // §18.3.1.2 autoFilter (AutoFilter Settings)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.autoFilter;\n\n        if (typeof o.startRow === 'number') {\n            let ele = promiseObj.xml.ele('autoFilter');\n            let filterRow = promiseObj.ws.rows[o.startRow];\n\n            o.startCol = typeof o.startCol === 'number' ? o.startCol : null;\n            o.endCol = typeof o.endCol === 'number' ? o.endCol : null;\n\n            if (typeof o.endRow !== 'number') {\n                let firstEmptyRow = undefined;\n                let curRow = o.startRow;\n                while (firstEmptyRow === undefined) {\n                    if (!promiseObj.ws.rows[curRow]) {\n                        firstEmptyRow = curRow;\n                    } else {\n                        curRow++;\n                    }\n                }\n\n                o.endRow = firstEmptyRow - 1;\n            }\n\n            // Columns to sort not manually set. filter all columns in this row containing data.\n            if (typeof o.startCol !== 'number' || typeof o.endCol !== 'number') {\n                o.startCol = filterRow.firstColumn;\n                o.endCol = filterRow.lastColumn;\n            }\n\n            let startCell = utils.getExcelAlpha(o.startCol) + o.startRow;\n            let endCell = utils.getExcelAlpha(o.endCol) + o.endRow;\n\n            ele.att('ref', `${startCell}:${endCell}`);\n            promiseObj.ws.wb.definedNameCollection.addDefinedName({\n                hidden: 1,\n                localSheetId: promiseObj.ws.localSheetId,\n                name: '_xlnm._FilterDatabase',\n                refFormula: '\\'' + promiseObj.ws.name + '\\'!' +\n                    '$' + utils.getExcelAlpha(o.startCol) +\n                    '$' + o.startRow +\n                    ':' +\n                    '$' + utils.getExcelAlpha(o.endCol) +\n                    '$' + o.endRow\n            });\n            ele.up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addMergeCells = (promiseObj) => {\n    // §18.3.1.55 mergeCells (Merge Cells)\n    return new Promise((resolve, reject) => {\n\n        if (promiseObj.ws.mergedCells instanceof Array && promiseObj.ws.mergedCells.length > 0) {\n            let ele = promiseObj.xml.ele('mergeCells').att('count', promiseObj.ws.mergedCells.length);\n            promiseObj.ws.mergedCells.forEach((cr) => {\n                ele.ele('mergeCell').att('ref', cr).up();\n            });\n            ele.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addConditionalFormatting = (promiseObj) => {\n    // §18.3.1.18 conditionalFormatting (Conditional Formatting)\n    return new Promise((resolve, reject) => {\n        promiseObj.ws.cfRulesCollection.addToXMLele(promiseObj.xml);\n        resolve(promiseObj);\n    });\n};\n\nlet _addHyperlinks = (promiseObj) => {\n    // §18.3.1.48 hyperlinks (Hyperlinks)\n    return new Promise((resolve, reject) => {\n        promiseObj.ws.hyperlinkCollection.addToXMLele(promiseObj.xml);\n        resolve(promiseObj);\n    });\n};\n\nlet _addDataValidations = (promiseObj) => {\n    // §18.3.1.33 dataValidations (Data Validations)\n    return new Promise((resolve, reject) => {\n        if (promiseObj.ws.dataValidationCollection.length > 0) {\n            promiseObj.ws.dataValidationCollection.addToXMLele(promiseObj.xml);\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet _addPrintOptions = (promiseObj) => {\n    // §18.3.1.70 printOptions (Print Options)\n    return new Promise((resolve, reject) => {\n\n        let addPrintOptions = false;\n        let o = promiseObj.ws.opts.printOptions;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addPrintOptions = true;\n            }\n        });\n\n        if (addPrintOptions) {\n            let poEle = promiseObj.xml.ele('printOptions');\n            o.centerHorizontal === true ? poEle.att('horizontalCentered', 1) : null;\n            o.centerVertical === true ? poEle.att('verticalCentered', 1) : null;\n            o.printHeadings === true ? poEle.att('headings', 1) : null;\n            if (o.printGridLines === true) {\n                poEle.att('gridLines', 1);\n                poEle.att('gridLinesSet', 1);\n            }\n            poEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addPageMargins = (promiseObj) => {\n    // §18.3.1.62 pageMargins (Page Margins)\n    return new Promise((resolve, reject) => {\n        let o = promiseObj.ws.opts.margins;\n\n        promiseObj.xml.ele('pageMargins')\n        .att('left', o.left)\n        .att('right', o.right)\n        .att('top', o.top)\n        .att('bottom', o.bottom)\n        .att('header', o.header)\n        .att('footer', o.footer)\n        .up();\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addPageSetup = (promiseObj) => {\n    // §18.3.1.63 pageSetup (Page Setup Settings)\n    return new Promise((resolve, reject) => {\n\n        let addPageSetup = false;\n        let o = promiseObj.ws.opts.pageSetup;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addPageSetup = true;\n            }\n        });\n\n        if (addPageSetup === true) {\n            let psEle = promiseObj.xml.ele('pageSetup');\n            o.paperSize !== null ? psEle.att('paperSize', types.paperSize[o.paperSize]) : null;\n            o.paperHeight !== null ? psEle.att('paperHeight', o.paperHeight) : null;\n            o.paperWidth !== null ? psEle.att('paperWidth', o.paperWidth) : null;\n            o.scale !== null ? psEle.att('scale', o.scale) : null;\n            o.firstPageNumber !== null ? psEle.att('firstPageNumber', o.firstPageNumber) : null;\n            o.fitToWidth !== null ? psEle.att('fitToWidth', o.fitToWidth) : null;\n            o.fitToHeight !== null ? psEle.att('fitToHeight', o.fitToHeight) : null;\n            o.pageOrder !== null ? psEle.att('pageOrder', o.pageOrder) : null;\n            o.orientation !== null ? psEle.att('orientation', o.orientation) : null;\n            o.usePrinterDefaults !== null ? psEle.att('usePrinterDefaults', utils.boolToInt(o.usePrinterDefaults)) : null;\n            o.blackAndWhite !== null ? psEle.att('blackAndWhite', utils.boolToInt(o.blackAndWhite)) : null;\n            o.draft !== null ? psEle.att('draft', utils.boolToInt(o.draft)) : null;\n            o.cellComments !== null ? psEle.att('cellComments', o.cellComments) : null;\n            o.useFirstPageNumber !== null ? psEle.att('useFirstPageNumber', utils.boolToInt(o.useFirstPageNumber)) : null;\n            o.errors !== null ? psEle.att('errors', o.errors) : null;\n            o.horizontalDpi !== null ? psEle.att('horizontalDpi', o.horizontalDpi) : null;\n            o.verticalDpi !== null ? psEle.att('verticalDpi', o.verticalDpi) : null;\n            o.copies !== null ? psEle.att('copies', o.copies) : null;\n            psEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addPageBreaks = (promiseObj) => {\n    // colBreaks (§18.3.1.14); rowBreaks (§18.3.1.74)\n    const rowBreaks = promiseObj.ws.pageBreaks.row;\n    if (rowBreaks.length > 0) {\n        const rbEle = promiseObj.xml.ele('rowBreaks');\n        rbEle.att('count', rowBreaks.length);\n        rbEle.att('manualBreakCount', rowBreaks.length);\n        rowBreaks.forEach(pos => {\n            const bEle = rbEle.ele('brk');\n            bEle.att('id', pos);\n            bEle.att('man', 1);\n            bEle.up();\n        });\n        rbEle.up();\n    }\n    const colBreaks = promiseObj.ws.pageBreaks.column;\n    if (colBreaks.length > 0) {\n        const cbEle = promiseObj.xml.ele('colBreaks');\n        cbEle.att('count', colBreaks.length);\n        cbEle.att('manualBreakCount', colBreaks.length);\n        colBreaks.forEach(pos => {\n            const bEle = cbEle.ele('brk');\n            bEle.att('id', pos);\n            bEle.att('man', 1);\n            bEle.up();\n        });\n        cbEle.up();\n    }\n    return promiseObj;\n}\n\nlet _addHeaderFooter = (promiseObj) => {\n    // §18.3.1.46 headerFooter (Header Footer Settings)\n    return new Promise((resolve, reject) => {\n\n        let addHeaderFooter = false;\n        let o = promiseObj.ws.opts.headerFooter;\n        Object.keys(o).forEach((k) => {\n            if (o[k] !== null) {\n                addHeaderFooter = true;\n            }\n        });\n\n        if (addHeaderFooter === true) {\n            let hfEle = promiseObj.xml.ele('headerFooter');\n\n            o.alignWithMargins !== null ? hfEle.att('alignWithMargins', utils.boolToInt(o.alignWithMargins)) : null;\n            o.differentFirst !== null ? hfEle.att('differentFirst', utils.boolToInt(o.differentFirst)) : null;\n            o.differentOddEven !== null ? hfEle.att('differentOddEven', utils.boolToInt(o.differentOddEven)) : null;\n            o.scaleWithDoc !== null ? hfEle.att('scaleWithDoc', utils.boolToInt(o.scaleWithDoc)) : null;\n\n            o.oddHeader !== null ? hfEle.ele('oddHeader').text(o.oddHeader).up() : null;\n            o.oddFooter !== null ? hfEle.ele('oddFooter').text(o.oddFooter).up() : null;\n            o.evenHeader !== null ? hfEle.ele('evenHeader').text(o.evenHeader).up() : null;\n            o.evenFooter !== null ? hfEle.ele('evenFooter').text(o.evenFooter).up() : null;\n            o.firstHeader !== null ? hfEle.ele('firstHeader').text(o.firstHeader).up() : null;\n            o.firstFooter !== null ? hfEle.ele('firstFooter').text(o.firstFooter).up() : null;\n            hfEle.up();\n        }\n\n        resolve(promiseObj);\n    });\n};\n\nlet _addDrawing = (promiseObj) => {\n    // §18.3.1.36 drawing (Drawing)\n    return new Promise((resolve, reject) => {\n        if (!promiseObj.ws.drawingCollection.isEmpty) {\n            let dId = promiseObj.ws.relationships.indexOf('drawing') + 1;\n            promiseObj.xml.ele('drawing').att('r:id', 'rId' + dId).up();\n        }\n        resolve(promiseObj);\n    });\n};\n\nlet sheetXML = (ws) => {\n    return new Promise((resolve, reject) => {\n\n        let xmlProlog = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>';\n        let xmlString = '';\n        let wsXML = xml.begin({\n          'allowSurrogateChars': true,\n        }, (chunk) => {\n            xmlString += chunk;\n        })\n\n        .ele('worksheet')\n        .att('mc:Ignorable', 'x14ac')\n        .att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main')\n        .att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006')\n        .att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships')\n        .att('xmlns:x14ac', 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');\n\n        // Excel complains if specific elements on not in the correct order in the XML doc.\n        let promiseObj = { xml: wsXML, ws: ws };\n\n        _addSheetPr(promiseObj)\n        .then(_addDimension)\n        .then(_addSheetViews)\n        .then(_addSheetFormatPr)\n        .then(_addCols)\n        .then(_addSheetData)\n        .then(_addSheetProtection)\n        .then(_addAutoFilter)\n        .then(_addMergeCells)\n        .then(_addConditionalFormatting)\n        .then(_addDataValidations)\n        .then(_addHyperlinks)\n        .then(_addPrintOptions)\n        .then(_addPageMargins)\n        .then(_addPageSetup)\n        .then(_addPageBreaks)\n        .then(_addHeaderFooter)\n        .then(_addDrawing)\n        .then((promiseObj) => {\n            return new Promise((resolve, reject) => {\n                wsXML.end();\n                resolve(xmlString);\n            });\n        })\n        .then((xml) => {\n            resolve(xml);\n        })\n        .catch((e) => {\n            throw new Error(e.stack);\n        });\n    });\n};\n\nlet relsXML = (ws) => {\n    return new Promise((resolve, reject) => {\n        let sheetRelRequired = false;\n        if (ws.relationships.length > 0) {\n            sheetRelRequired = true;\n        }\n\n        if (sheetRelRequired === false) {\n            resolve();\n        }\n\n        let relXML = xml.create(\n            'Relationships',\n            {\n                'version': '1.0',\n                'encoding': 'UTF-8',\n                'standalone': true,\n                'allowSurrogateChars': true\n            }\n        );\n        relXML.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n        ws.relationships.forEach((r, i) => {\n            let rId = 'rId' + (i + 1);\n            if (r instanceof hyperlinks.Hyperlink) {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', r.location)\n                .att('TargetMode', 'External')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink');\n            } else if (r === 'drawing') {\n                relXML.ele('Relationship')\n                .att('Id', rId)\n                .att('Target', '../drawings/drawing' + ws.sheetId + '.xml')\n                .att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing');\n            }\n        });\n        let xmlString = relXML.doc().end();\n        resolve(xmlString);\n    });\n};\n\nmodule.exports = { sheetXML, relsXML };\n"]}